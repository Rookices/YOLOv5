<div align='center' ><font size='150'><big><b>条码数据集调整测试报告</b></big></font></div>

[概要](#1 概要) 

[1 条码数据集](#1-条码数据集) 

[2 数据集测试](#2-数据集测试)

[3 总结](#3-综合分析) 

# 概要

​		本文档面向数据集标注人员，主要描述数据标注质量对训练模型精度的影响。包含数据集调整方针，模型测试以及对应模型泛化性测试。

# 1 条码数据集

应用场景：通用场景下的dmcode & qrcode & 1D-barcode识别检测。

## 1.1 现存问题

起因：部分条码检测得分较低，偶尔出现**截断现象**，dm码**残缺码误识率较高**，**预测框冗余度高**。

原因追溯：实际样本标注存在较大误差，包括**超出边界**、**标注错位**、**目标漏标注**及**标注不精确**等问题，如下图。

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E6%95%B4%E7%90%86%E6%96%B9%E9%92%88-%E6%9D%A1%E7%A0%81%E6%88%AA%E6%96%AD%E9%94%99%E8%AF%AF%E6%A0%B7%E6%9C%AC.png" alt="条码截断错误样本" style="zoom: 25%;" align=lift/><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E6%95%B4%E7%90%86%E6%96%B9%E9%92%88-%E6%9D%A1%E7%A0%81%E6%A0%87%E6%B3%A8%E9%94%99%E8%AF%AF%E6%A0%B7%E6%9C%AC.png" alt="条码标注错误样本" style="zoom: 25%;" align=center/><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E6%95%B4%E7%90%86%E6%96%B9%E9%92%88-DM%E6%AE%8B%E7%BC%BA%E7%A0%81%E9%94%99%E8%AF%AF%E6%A0%B7%E6%9C%AC.png" alt="DM残缺码错误样本" style="zoom: 25%;" align=right/><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E6%95%B4%E7%90%86%E6%96%B9%E9%92%88-%E9%9A%BE%E6%A0%87%E6%B3%A8%E6%A0%B7%E6%9C%AC.png" alt="难标注样本" style="zoom: 25%;" align=right/></center>

数据集组成包含train-24330张，val-2701张，test-3112张。样本量较大划分比例应采用98:1:1

## 1.2 调整方针

①参照VOC标注准则：

> 1. 去除所有被遮挡大于5%的目标
>2. 模糊但外形完整(不含拖影)需要标注
> 3. 图片中所有物体必须标注，不易标注样本应当去除

②结合条码外形特征及纠错能力

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E6%95%B4%E7%90%86%E6%96%B9%E9%92%88-DM%E7%A0%81%E7%BB%84%E6%88%90.jpg" alt="DM码组成" style="zoom: 75%;" align=lift/></center>

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E6%95%B4%E7%90%86%E6%96%B9%E9%92%88-%E4%BA%8C%E7%BB%B4%E7%A0%81%E7%BB%84%E6%88%90.png" alt="二维码组成" style="zoom: 75%;" align=center/><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E6%95%B4%E7%90%86%E6%96%B9%E9%92%88-%E6%9D%A1%E5%BD%A2%E7%A0%81%E7%BB%84%E6%88%90.png" alt="条形码组成" style="zoom: 75%;" align=right/></center>

​		如上，考虑到DM码和QR码均可通过位置标识实现定位，数据区域具备一定纠错能力。因此标注重点是保证外轮廓的完备性；而对于barcode则要保证数据符粗细，其中供人识别字符可不包含在标注范围内。

## 1.3 现有数据集组成

|          | dmcode | qrcode | 1D-barcode | multi |  sum  |
| :------: | :----: | :----: | :--------: | :---: | :---: |
| 图片数量 |  6417  |  5343  |    5619    | 8156  | 25535 |

### 实际标签分布情况

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-%E6%A0%87%E7%AD%BE%E5%88%86%E5%B8%83.jpg" alt="标签分布" style="zoom: 75%;" align=lift/></center>

样本依旧存在不平衡，后续会增加dmcode样本

# 2 数据集测试

## 2.1 测试环境

主要依赖环境为服务器vision002，算法框架选取[YOLOv5_v4.0](https://github.com/ultralytics/yolov5/tree/v4.0)，模型为基于5s的通道减半。

## 2.2 训练

收敛速度更快，完全拟合由原来1500epochs降至800epochs

## 2.3 测试结果对比

conf-thres=0.5，iou-thres=0.5；其中查准率P=TP/(TP+FP)  查全率R=TP/(TP+FN)，因此误检率为1-P，漏检率为1-R

### 测试集结果（新vs旧）

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-new_%E6%B5%8B%E8%AF%95%E9%9B%86.png" alt="new_测试集" style="zoom: 100%;" align=lift/></center>

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-old_%E6%B5%8B%E8%AF%95%E9%9B%86.png" alt="old_测试集" style="zoom: 100%;" align=lift/></center>

​		模型精度提升明显，尤其barcode得到较好改善

### 大角度倾斜条形码（新vs旧）-只检测barcode

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-new_%E5%A4%A7%E8%A7%92%E5%BA%A6%E6%97%8B%E8%BD%AC%E6%9D%A1%E7%A0%81.png" alt="new_大角度旋转条码" style="zoom: 100%;" align=lift/></center>

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-old_%E5%A4%A7%E8%A7%92%E5%BA%A6%E6%97%8B%E8%BD%AC%E6%9D%A1%E7%A0%81.png" alt="old_大角度旋转条码" style="zoom: 100%;" align=lift/></center>

​		精度有提升，但漏检率较高导致mmAP数值较低

## 2.4  检测结果可视化

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-new%E6%A3%80%E6%B5%8B%E7%BB%93%E6%9E%9C%E5%8F%AF%E8%A7%86%E5%8C%96.gif" alt="new检测结果可视化" style="zoom: 75%;" align=lift/></center>

### 小结

​		预测框更精确，与实际标注框偏差较小。

## 2.5 补充测试 

### 2.5.1 AIfailPic

<center><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-AIfailPic%20(1).jpg" alt="AIfailPic-1" style="zoom: 20%;" align=lift/><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-AIfailPic%20(2).jpg" alt="AIfailPic-2" style="zoom: 20%;" align=center/><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-AIfailPic%20(3).jpg" alt="AIfailPic-3" style="zoom: 20%;" align=center/><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-AIfailPic%20(4).jpg" alt="AIfailPic-4" style="zoom: 20%;" align=right/><img src="https://whiskey-tuku.oss-cn-beijing.aliyuncs.com/img/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3&%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/%E6%9D%A1%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86%E8%B0%83%E6%95%B4%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A-AIfailPic%20(5).jpg" alt="AIfailPic-5" style="zoom: 20%;" align=right/></center>

​		可能原因：对于模糊图片泛化性较差，点阵dmcode缺少样本。

### 2.5.2 dpm(to do)





# 3 综合分析

​		综上，调整数据集后对模型提升效果明显，体现在：①**精度提升**，为后续模型压缩提供更大空间；②**预测框更精确**，降低ROI冗余度；③**能较好识别出倾斜barcode**。目前仍存在以下问题：①倾斜barcode漏检问题，主要原因是现阶段数据集并没有加入倾斜barcode样本，后续可考虑加入少量倾斜条码样本；②样本不平衡问题

#### To-do list:

- [ ] 加入dpm数据集
- [ ] 加入少量倾斜条形码样本
